@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix v-s: <http://semantic-machines.com/veda/veda-schema/> .
@prefix v-ui: <http://semantic-machines.com/veda/veda-ui/> .
@prefix d: <http://semantic-machines.com/veda/veda-data/> .
@prefix cfg: <http://semantic-machines.com/veda/config/> .

<http://semantic-machines.com/veda/veda-contractorProfile-ui>
  rdf:type owl:Ontology ;
  rdfs:label "Онтология системы Veda. Досье контрагента. Интерфейс."@ru ;
  rdfs:label "Veda system ontology. ContractorProfile. UI."@en ;
  v-s:loadPriority 6 ;
.
# --------------------------------------------------------------- СТРОКИ --
v-s:AddOKVEDName
  rdf:type v-s:Bundle ;
  rdfs:label "Возможные виды деятельности компании по выписке из ЕГРЮЛ"@ru ;
  rdfs:label "Possible activities of the company"@en ;
.
v-s:AddOKVEDNameCoordinated
  rdf:type v-s:Bundle ;
  rdfs:label "Согласованние видов деятельности компании"@ru ;
  rdfs:label "Coordinated activities of the company"@en ;
.
v-s:AddOKVEDNameRequested
  rdf:type v-s:Bundle ;
  rdfs:label "Проверяемые виды деятельности для Mondi, включая субподряд"@ru ;
  rdfs:label "Coordinated activities of the company"@en ;
.
v-s:AddRegistrNamberReestr
  rdf:type v-s:Bundle ;
  rdfs:label "Регистрационный номер контрагента"@ru ;
  rdfs:label "Registration number of the counterparty"@en ;
.
v-s:AddDateactions
  rdf:type v-s:Bundle ;
  rdfs:label "Период действия документа"@ru ;
  rdfs:label "The period of validity of the document"@en ;
.


# --------------------------------------------------------------- ШАБЛОНЫ --

v-s:PriceTemplate
  rdf:type v-ui:ClassTemplate ;
  rdfs:label "Шаблон для класса v-s:Price внутри v-s:ContractorCategoryRequest"@ru ;
  rdfs:label "Template for v-s:Price class in v-s:ContractorCategoryRequest"@en ;
  v-ui:template """
<div class="panel panel-default">
  <div class="panel-body">
    <div class="row">
      <div class="col-md-3">
        <em about="v-s:sum" property="rdfs:label" class="margin-sm"></em>
        <span property="v-s:sum" class="view -edit search"></span>
        <veda-control data-type="decimal" property="v-s:sum" class="-view edit search"></veda-control>
      </div>
      <div class="col-md-3">
        <em about="v-s:hasCurrency" property="rdfs:label" class="margin-sm"></em>
        <span rel="v-s:hasCurrency" class="view -edit search" data-template="v-ui:LabelTemplate"></span>
        <veda-control data-type="link" rel="v-s:hasCurrency" class="-view edit search fulltext dropdown"></veda-control>
      </div>
      <div class="col-md-3 view edit -search">
        <em about="v-s:sumRuble" property="rdfs:label" class="margin-sm"></em>
        <span about="@" property="v-s:sumRuble" class="view edit -search"></span>
      </div>
      <div class="col-md-3 view edit -search">
        <em about="v-s:date" property="rdfs:label" class="margin-sm"></em>
        <span about="@" property="v-s:date" class="view edit -search"></span>
      </div>
    </div>
  </div>
</div>
<script>
  individual.on("propertyModified", handler);
  template.one("remove", function () {
    individual.off("propertyModified", handler);
  });

  function handler(property_uri) {
    if ( (property_uri === "v-s:sum" || property_uri === "v-s:hasCurrency") && (individual.hasValue("v-s:sum") && individual.hasValue("v-s:hasCurrency")) ) {
      var CER_uri = veda.Backend.query({
        ticket: veda.ticket,
        query: "'rdf:type'==='v-s:CurrencyExchangeRate' && 'v-s:hasCurrencySource'=='" + individual["v-s:hasCurrency"][0].id + "' && 'v-s:hasCurrencyTarget'=='d:currency_rub' && 'v-s:hasCurrencyExchangeRatePurpose'=='v-s:CER_Purpose_current'",
        sort: "'v-s:date' asc",
        top: 1,
        async: true
      }).then(function (queryResult) {
        var CER_uri = queryResult.result[0];
        if (CER_uri) {
          return new veda.IndividualModel(CER_uri).load();
        } else {
          return Promise.resolve();
        }
      }).then(function (CER) {
        if (CER) {
          var rate = CER["v-s:rate"][0];
          individual["v-s:sumRuble"] = [ individual["v-s:sum"][0] * rate ];
          individual["v-s:date"] = [ new Date() ];
        } else {
          individual["v-s:sumRuble"] = [];
          individual["v-s:date"] = [];
        }
      });
    }
  }
  
</script>
  """ ;
.
